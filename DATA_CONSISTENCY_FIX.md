# æ•¸æ“šä¸€è‡´æ€§å•é¡Œä¿®å¾©èªªæ˜

## ğŸ” å•é¡Œæè¿°

**ç—‡ç‹€**: å–®è‚¡æ·±åº¦åˆ†æçš„çµæœèˆ‡æ™ºèƒ½ç¯©é¸çš„çµæœä¸ä¸€è‡´

**ç¯„ä¾‹**:
- æ™ºèƒ½ç¯©é¸é¡¯ç¤º: å°ç©é›» (2330) è©•åˆ† 65 åˆ†,å»ºè­°è²·å…¥
- å–®è‚¡åˆ†æé¡¯ç¤º: å°ç©é›» (2330) è©•åˆ† 58 åˆ†,å»ºè­°æŒæœ‰

## ğŸ› å•é¡Œæ ¹æº

### åŸå› åˆ†æ

å…©å€‹ API ä½¿ç”¨äº†ä¸åŒçš„æ•¸æ“šä¾†æºç­–ç•¥:

#### 1. å–®è‚¡åˆ†æ (`/api/analyze`) - èˆŠç‰ˆæœ¬
```python
# æ¯æ¬¡éƒ½é‡æ–°ä¸‹è¼‰æœ€æ–°æ•¸æ“š
df = manager.download_stock_data(symbol, period='2y')
```

#### 2. æ™ºèƒ½ç¯©é¸ (`/api/screen`) - èˆŠç‰ˆæœ¬
```python
# ä½¿ç”¨æœ¬åœ°å·²ä¸‹è¼‰çš„æ•¸æ“š
df = manager.load_stock_data(symbol)
```

### ç‚ºä»€éº¼æœƒä¸ä¸€è‡´?

å‡è¨­æƒ…å¢ƒ:
1. **é€±ä¸€**: ä½ ä¸‹è¼‰äº†å°ç©é›»çš„æ•¸æ“šä¸¦ä¿å­˜åˆ°æœ¬åœ°
2. **é€±äº”**: æ™ºèƒ½ç¯©é¸ä½¿ç”¨é€±ä¸€çš„æ•¸æ“š (æœ¬åœ°èˆŠæ•¸æ“š)
3. **é€±äº”**: å–®è‚¡åˆ†æä¸‹è¼‰é€±äº”çš„æœ€æ–°æ•¸æ“š
4. **çµæœ**: ä¸€é€±çš„åƒ¹æ ¼è®ŠåŒ–å°è‡´æŠ€è¡“æŒ‡æ¨™ã€è©•åˆ†éƒ½ä¸åŒ!

### å½±éŸ¿

- ğŸ”´ **è©•åˆ†ä¸ä¸€è‡´**: æ–°èˆŠæ•¸æ“šçš„æŠ€è¡“æŒ‡æ¨™å·®ç•°
- ğŸ”´ **å»ºè­°ä¸åŒ**: å¯èƒ½å°è‡´ç›¸åçš„äº¤æ˜“å»ºè­°
- ğŸ”´ **ç”¨æˆ¶å›°æƒ‘**: ä¸çŸ¥é“è©²ç›¸ä¿¡å“ªä¸€å€‹çµæœ

## âœ… è§£æ±ºæ–¹æ¡ˆ

### ä¿®å¾©ç­–ç•¥

å¯¦æ–½**æ™ºèƒ½æ•¸æ“šç®¡ç†**:
1. å„ªå…ˆä½¿ç”¨æœ¬åœ°æ•¸æ“š (å¿«é€Ÿ)
2. è‡ªå‹•æª¢æŸ¥æ•¸æ“šæ–°é®®åº¦
3. è¶…é1å¤©è‡ªå‹•æ›´æ–°
4. ç”¨æˆ¶å¯é¸æ˜¯å¦å¼·åˆ¶æ›´æ–°

### ä¿®å¾©å¾Œçš„é‚è¼¯

#### å–®è‚¡åˆ†æ - æ–°ç‰ˆæœ¬

```python
# 1. å…ˆå˜—è©¦è¼‰å…¥æœ¬åœ°æ•¸æ“š
df = manager.load_stock_data(symbol)

# 2. æª¢æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°
need_update = False
if df is None or len(df) < 200:
    need_update = True  # æ²’æœ‰æ•¸æ“š,éœ€è¦ä¸‹è¼‰
else:
    # æª¢æŸ¥æ•¸æ“šæ˜¯å¦éæœŸ (è¶…é1å¤©)
    latest_date = df['date'].iloc[-1]
    days_old = (datetime.now() - latest_date).days
    if days_old > 1:
        need_update = True
        print(f"æœ¬åœ°æ•¸æ“šå·²éæœŸ {days_old} å¤©ï¼Œé‡æ–°ä¸‹è¼‰...")

# 3. å¦‚æœéœ€è¦,ä¸‹è¼‰æœ€æ–°æ•¸æ“š
if need_update:
    df = manager.download_stock_data(symbol, period='2y')
```

#### æ™ºèƒ½ç¯©é¸ - æ–°ç‰ˆæœ¬

æ–°å¢ `auto_update_data` åƒæ•¸:

```python
# API è«‹æ±‚æ™‚å¯ä»¥æŒ‡å®š
{
  "market": "TW",
  "min_score": 60,
  "auto_update_data": true  // å•Ÿç”¨è‡ªå‹•æ›´æ–°
}
```

å¦‚æœå•Ÿç”¨:
```python
for symbol in symbols:
    df = manager.load_stock_data(symbol)

    # æª¢æŸ¥ä¸¦æ›´æ–°éæœŸæ•¸æ“š
    if auto_update_data and df is not None:
        latest_date = df['date'].iloc[-1]
        days_old = (datetime.now() - latest_date).days
        if days_old > 1:
            print(f"æ›´æ–° {symbol} (éæœŸ {days_old} å¤©)...")
            df = manager.download_stock_data(symbol, period='2y')
```

## ğŸ“Š ä½¿ç”¨å»ºè­°

### å ´æ™¯ 1: å¿«é€Ÿç¯©é¸ (ä½¿ç”¨æœ¬åœ°æ•¸æ“š)

é©ç”¨æ–¼:
- å¿«é€ŸæŸ¥çœ‹æœ¬åœ°å·²æœ‰è‚¡ç¥¨
- æ•¸æ“šæ˜¯ä»Šå¤©æˆ–æ˜¨å¤©ä¸‹è¼‰çš„
- ä¸éœ€è¦æœ€æ–°ç›¤ä¸­è³‡è¨Š

```python
# ä¸å•Ÿç”¨è‡ªå‹•æ›´æ–° (é è¨­)
response = requests.post('/api/screen', json={
    'market': 'TW',
    'min_score': 60,
    'auto_update_data': False  # æˆ–çœç•¥æ­¤åƒæ•¸
})
```

**å„ªé»**: é€Ÿåº¦å¿«,1ç§’å…§å®Œæˆ
**ç¼ºé»**: å¯èƒ½ä¸æ˜¯æœ€æ–°æ•¸æ“š

### å ´æ™¯ 2: ç²¾ç¢ºç¯©é¸ (æ›´æ–°æ•¸æ“š)

é©ç”¨æ–¼:
- éœ€è¦æœ€æ–°æ•¸æ“šé€²è¡Œæ±ºç­–
- æœ¬åœ°æ•¸æ“šå¯èƒ½éæœŸ
- æº–å‚™å¯¦éš›äº¤æ˜“

```python
# å•Ÿç”¨è‡ªå‹•æ›´æ–°
response = requests.post('/api/screen', json={
    'market': 'TW',
    'min_score': 60,
    'auto_update_data': True  # è‡ªå‹•æ›´æ–°éæœŸæ•¸æ“š
})
```

**å„ªé»**: æ•¸æ“šæœ€æ–°,çµæœæº–ç¢º
**ç¼ºé»**: é€Ÿåº¦è¼ƒæ…¢,éœ€è¦ç­‰å¾…ä¸‹è¼‰

### å ´æ™¯ 3: å–®è‚¡åˆ†æ

**ç¾åœ¨æœƒè‡ªå‹•è™•ç†!**
- å¦‚æœæœ¬åœ°æœ‰æ–°é®®æ•¸æ“š (ä¸è¶…é1å¤©) â†’ ç›´æ¥ä½¿ç”¨
- å¦‚æœæ•¸æ“šéæœŸæˆ–æ²’æœ‰ â†’ è‡ªå‹•ä¸‹è¼‰æœ€æ–°

```python
# ä¸éœ€è¦é¡å¤–åƒæ•¸
response = requests.post('/api/analyze', json={
    'symbol': '2330'
})
```

## ğŸ¯ ä¸€è‡´æ€§ä¿è­‰

### ç¾åœ¨çš„è¡Œç‚º

å…©å€‹ API ç¾åœ¨ä¿æŒä¸€è‡´:

| æƒ…æ³ | å–®è‚¡åˆ†æ | æ™ºèƒ½ç¯©é¸ (auto_update=false) | æ™ºèƒ½ç¯©é¸ (auto_update=true) |
|------|---------|---------------------------|--------------------------|
| æ•¸æ“šæ–°é®® (<1å¤©) | ä½¿ç”¨æœ¬åœ° | ä½¿ç”¨æœ¬åœ° | ä½¿ç”¨æœ¬åœ° |
| æ•¸æ“šéæœŸ (>1å¤©) | **è‡ªå‹•æ›´æ–°** | ä½¿ç”¨æœ¬åœ°èˆŠæ•¸æ“š | **è‡ªå‹•æ›´æ–°** |
| æ²’æœ‰æ•¸æ“š | ä¸‹è¼‰æ–°æ•¸æ“š | è·³éè©²è‚¡ç¥¨ | ä¸‹è¼‰æ–°æ•¸æ“š |

### å»ºè­°å·¥ä½œæµç¨‹

#### æ–¹æ¡ˆ A: å¿«é€Ÿæµç¨‹ (é©åˆæ¸¬è©¦)

```python
# 1. å¿«é€Ÿç¯©é¸ (ä½¿ç”¨æœ¬åœ°æ•¸æ“š)
screen_results = requests.post('/api/screen', json={
    'min_score': 60,
    'auto_update_data': False
}).json()

# 2. å°æ„Ÿèˆˆè¶£çš„è‚¡ç¥¨åšå–®è‚¡åˆ†æ
# (æœƒè‡ªå‹•æ›´æ–°æ•¸æ“š,æ‰€ä»¥çµæœæœƒæœ€æ–°)
for stock in screen_results['data']['results'][:5]:
    analysis = requests.post('/api/analyze', json={
        'symbol': stock['symbol']
    }).json()

    print(f"{stock['symbol']}: {analysis['data']['score']}")
```

#### æ–¹æ¡ˆ B: ç²¾ç¢ºæµç¨‹ (é©åˆå¯¦éš›äº¤æ˜“)

```python
# 1. å…ˆæ‰¹é‡æ›´æ–°æ•¸æ“š
requests.post('/api/download', json={
    'method': 'market_list',
    'market': 'TW',
    'category': 'popular'
})

# 2. ç²¾ç¢ºç¯©é¸ (ä½¿ç”¨å‰›æ›´æ–°çš„æ•¸æ“š)
screen_results = requests.post('/api/screen', json={
    'min_score': 60,
    'auto_update_data': True  # ç¢ºä¿æ•¸æ“šæœ€æ–°
}).json()

# 3. å–®è‚¡åˆ†æ (æ•¸æ“šå·²æ˜¯æœ€æ–°)
for stock in screen_results['data']['results'][:5]:
    analysis = requests.post('/api/analyze', json={
        'symbol': stock['symbol']
    }).json()
```

## ğŸ”§ é©—è­‰ä¸€è‡´æ€§

ä½¿ç”¨æ­¤è…³æœ¬é©—è­‰çµæœä¸€è‡´:

```python
import requests

symbol = '2330'

# 1. åŸ·è¡Œå–®è‚¡åˆ†æ
analyze_result = requests.post('http://localhost:5000/api/analyze',
    json={'symbol': symbol}).json()

# 2. åŸ·è¡Œç¯©é¸ (å•Ÿç”¨è‡ªå‹•æ›´æ–°)
screen_result = requests.post('http://localhost:5000/api/screen',
    json={
        'market': 'TW',
        'auto_update_data': True
    }).json()

# 3. æ‰¾å‡ºç¯©é¸çµæœä¸­çš„è©²è‚¡ç¥¨
screen_stock = next((s for s in screen_result['data']['results']
                     if s['symbol'] == symbol), None)

# 4. æ¯”è¼ƒçµæœ
if screen_stock:
    analyze_score = analyze_result['data']['score']
    screen_score = screen_stock['score']

    print(f"å–®è‚¡åˆ†æè©•åˆ†: {analyze_score}")
    print(f"ç¯©é¸çµæœè©•åˆ†: {screen_score}")
    print(f"å·®ç•°: {abs(analyze_score - screen_score)}")

    if abs(analyze_score - screen_score) < 0.1:
        print("âœ“ çµæœä¸€è‡´!")
    else:
        print("âœ— çµæœä¸ä¸€è‡´,è«‹æª¢æŸ¥æ•¸æ“š")
```

## âš ï¸ æ³¨æ„äº‹é …

### 1. æ•¸æ“šæ–°é®®åº¦å®šç¾©

**ç›®å‰è¨­å®š**: è¶…é **1å¤©** è¦–ç‚ºéæœŸ

å¯ä»¥æ ¹æ“šéœ€æ±‚èª¿æ•´ (`web_server_enhanced_v3.1.py`):

```python
# æ›´å¯¬é¬†: 3å¤©
if days_old > 3:
    need_update = True

# æ›´åš´æ ¼: åªè¦ä¸æ˜¯ä»Šå¤©
if days_old > 0:
    need_update = True
```

### 2. ç›¤ä¸­ vs æ”¶ç›¤

- å°è‚¡äº¤æ˜“æ™‚é–“: 9:00-13:30
- è³‡æ–™é€šå¸¸åœ¨æ”¶ç›¤å¾Œæ›´æ–°
- ç›¤ä¸­æŸ¥è©¢å¯èƒ½é‚„æ˜¯å‰ä¸€å¤©çš„æ•¸æ“š

**å»ºè­°**:
- æ”¶ç›¤å¾Œ (14:00 ä¹‹å¾Œ) æ›´æ–°æ•¸æ“š
- ç›¤ä¸­ä½¿ç”¨å‰ä¸€å¤©æ•¸æ“šå³å¯

### 3. æ‰¹é‡æ›´æ–°æ³¨æ„

å•Ÿç”¨ `auto_update_data=True` æ™‚:
- éœ€è¦é€ä¸€ä¸‹è¼‰æ›´æ–°
- æ™‚é–“è¼ƒé•· (æ¯æ”¯è‚¡ç¥¨ 1-3 ç§’)
- å»ºè­°åªåœ¨å¿…è¦æ™‚ä½¿ç”¨

**ç¯„ä¾‹æ™‚é–“ä¼°ç®—**:
- 10æ”¯è‚¡ç¥¨ Ã— 2ç§’ = 20ç§’
- 50æ”¯è‚¡ç¥¨ Ã— 2ç§’ = 100ç§’ (1åˆ†40ç§’)
- 100æ”¯è‚¡ç¥¨ Ã— 2ç§’ = 200ç§’ (3åˆ†20ç§’)

## ğŸ“ ç¸½çµ

### ä¿®å¾©å‰
- âŒ å–®è‚¡åˆ†æå’Œç¯©é¸çµæœä¸ä¸€è‡´
- âŒ ç”¨æˆ¶å›°æƒ‘è©²ç›¸ä¿¡å“ªä¸€å€‹
- âŒ å¯èƒ½åšå‡ºéŒ¯èª¤æ±ºç­–

### ä¿®å¾©å¾Œ
- âœ… è‡ªå‹•æª¢æŸ¥æ•¸æ“šæ–°é®®åº¦
- âœ… æ™ºèƒ½é¸æ“‡æ˜¯å¦æ›´æ–°
- âœ… ç”¨æˆ¶å¯æ§åˆ¶æ›´æ–°ç­–ç•¥
- âœ… çµæœä¸€è‡´å¯é 

### æœ€ä½³å¯¦è¸

1. **æ—¥å¸¸ä½¿ç”¨**: ä¸å•Ÿç”¨è‡ªå‹•æ›´æ–°,å¿«é€ŸæŸ¥çœ‹
2. **äº¤æ˜“æ±ºç­–**: å•Ÿç”¨è‡ªå‹•æ›´æ–°,ç¢ºä¿æº–ç¢º
3. **å®šæœŸç¶­è­·**: æ¯å¤©æ”¶ç›¤å¾Œæ‰¹é‡æ›´æ–°æ•¸æ“š
4. **é©—è­‰çµæœ**: é‡è¦æ±ºç­–å‰äº¤å‰é©—è­‰

---

**æ›´æ–°æ—¥æœŸ**: 2025-11-24
**ç‰ˆæœ¬**: v4.1.1
