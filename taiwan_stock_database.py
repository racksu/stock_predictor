"""
台股完整分類資料庫
Taiwan Stock Classification Database

包含台灣上市公司完整分類和清單
資料來源: 台灣證券交易所
"""

# ============================================================
# 台股產業分類 (依台灣證券交易所分類)
# ============================================================

TAIWAN_STOCK_CATEGORIES = {
    
    # ========== 科技類股 ==========
    "半導體": {
        "name": "半導體產業",
        "description": "晶圓代工、IC設計、封裝測試",
        "symbols": [
            "2330",  # 台積電
            "2303",  # 聯電
            "2454",  # 聯發科
            "3034",  # 聯詠
            "2408",  # 南亞科
            "3711",  # 日月光投控
            "2337",  # 旺宏
            "2344",  # 華邦電
            "2323",  # 中環
            "3443",  # 創意
            "3529",  # 力旺
            "5274",  # 信驊
            "6446",  # 藥華藥
            "2379",  # 瑞昱
            "3006",  # 晶豪科
            "8046",  # 南電
            "2449",  # 京元電子
            "2458",  # 義隆
            "2436",  # 偉詮電
            "3231",  # 緯創
        ]
    },
    
    "電子零組件": {
        "name": "電子零組件",
        "description": "被動元件、PCB、連接器",
        "symbols": [
            "2308",  # 台達電
            "2382",  # 廣達
            "2301",  # 光寶科
            "2327",  # 國巨
            "3008",  # 大立光
            "2409",  # 友達
            "2474",  # 可成
            "2395",  # 研華
            "2324",  # 仁寶
            "2356",  # 英業達
            "3231",  # 緯創
            "2345",  # 智邦
            "2373",  # 震旦行
            "6505",  # 台塑化
            "2347",  # 聯強
        ]
    },
    
    "電腦及週邊": {
        "name": "電腦及週邊設備",
        "description": "筆電、桌機、伺服器、周邊",
        "symbols": [
            "2357",  # 華碩
            "2353",  # 宏碁
            "2382",  # 廣達
            "2324",  # 仁寶
            "3231",  # 緯創
            "2356",  # 英業達
            "3045",  # 台灣大
            "2352",  # 佳世達
            "6214",  # 精誠
            "3217",  # 優群
        ]
    },
    
    "通信網路": {
        "name": "通信網路產業",
        "description": "網通設備、電信服務",
        "symbols": [
            "2412",  # 中華電
            "3045",  # 台灣大
            "4904",  # 遠傳
            "2345",  # 智邦
            "2399",  # 映泰
            "3037",  # 欣興
            "2368",  # 金像電
            "6592",  # 和潤企業
        ]
    },
    
    "光電": {
        "name": "光電產業",
        "description": "面板、LED、光學元件",
        "symbols": [
            "2409",  # 友達
            "3008",  # 大立光
            "2301",  # 光寶科
            "3481",  # 群創
            "2393",  # 億光
            "2499",  # 東貝
            "3406",  # 玉晶光
            "6116",  # 彩晶
        ]
    },
    
    # ========== 金融類股 ==========
    "金控": {
        "name": "金融控股",
        "description": "金控公司",
        "symbols": [
            "2882",  # 國泰金
            "2881",  # 富邦金
            "2891",  # 中信金
            "2886",  # 兆豐金
            "2884",  # 玉山金
            "2892",  # 第一金
            "2880",  # 華南金
            "2887",  # 台新金
            "5880",  # 合庫金
            "2890",  # 永豐金
            "2883",  # 開發金
            "2885",  # 元大金
            "5876",  # 上海商銀
        ]
    },
    
    "銀行": {
        "name": "銀行",
        "description": "商業銀行",
        "symbols": [
            "2801",  # 彰銀
            "2809",  # 京城銀
            "2812",  # 台中銀
            "2834",  # 臺企銀
            "2836",  # 高雄銀
            "2838",  # 聯邦銀
            "2845",  # 遠東銀
            "2849",  # 安泰銀
        ]
    },
    
    "保險": {
        "name": "保險",
        "description": "壽險、產險",
        "symbols": [
            "2823",  # 中壽
            "2832",  # 台產
            "2851",  # 中再保
            "2867",  # 三商壽
            "5871",  # 中租-KY
        ]
    },
    
    "證券": {
        "name": "證券",
        "description": "證券商",
        "symbols": [
            "2855",  # 統一證
            "2856",  # 元富證
            "6005",  # 群益證
            "6024",  # 群益期
        ]
    },
    
    # ========== 傳產類股 ==========
    "鋼鐵": {
        "name": "鋼鐵工業",
        "description": "鋼鐵、金屬",
        "symbols": [
            "2002",  # 中鋼
            "2006",  # 東和鋼鐵
            "2009",  # 第一銅
            "2010",  # 春源
            "2012",  # 春雨
            "2013",  # 中鋼構
            "2014",  # 中鴻
            "2015",  # 豐興
            "2017",  # 官田鋼
        ]
    },
    
    "塑膠化工": {
        "name": "塑膠化工",
        "description": "塑膠、化學原料",
        "symbols": [
            "1301",  # 台塑
            "1303",  # 南亞
            "1326",  # 台化
            "6505",  # 台塑化
            "1402",  # 遠東新
            "4706",  # 大立
            "1434",  # 福懋
            "1476",  # 儒鴻
        ]
    },
    
    "水泥": {
        "name": "水泥工業",
        "description": "水泥製造",
        "symbols": [
            "1101",  # 台泥
            "1102",  # 亞泥
            "1103",  # 嘉泥
            "1104",  # 環泥
            "1108",  # 幸福
            "1109",  # 信大
            "1110",  # 東泥
        ]
    },
    
    "紡織纖維": {
        "name": "紡織纖維",
        "description": "紡織、成衣",
        "symbols": [
            "1440",  # 南紡
            "1443",  # 立益
            "1445",  # 大宇
            "1449",  # 佳和
            "1451",  # 年興
            "1463",  # 強盛
            "1464",  # 得力
            "1465",  # 偉全
            "1466",  # 聚隆
            "1467",  # 南緯
            "1468",  # 昶和
            "1470",  # 大統
            "1471",  # 首利
            "1472",  # 三洋紡
            "1473",  # 台南
            "1474",  # 弘裕
        ]
    },
    
    "造紙": {
        "name": "造紙工業",
        "description": "紙漿、紙製品",
        "symbols": [
            "1904",  # 正隆
            "1907",  # 永豐餘
            "1909",  # 榮成
        ]
    },
    
    # ========== 民生消費 ==========
    "食品": {
        "name": "食品工業",
        "description": "食品製造",
        "symbols": [
            "1216",  # 統一
            "1227",  # 佳格
            "1229",  # 聯華
            "1231",  # 聯華食
            "1232",  # 大統益
            "1233",  # 天仁
            "1234",  # 黑松
        ]
    },
    
    "觀光": {
        "name": "觀光事業",
        "description": "旅館、餐飲",
        "symbols": [
            "2704",  # 國賓
            "2705",  # 六福
            "2706",  # 第一店
            "2707",  # 晶華
            "2718",  # 晶悅
        ]
    },
    
    "百貨": {
        "name": "百貨貿易",
        "description": "百貨、零售",
        "symbols": [
            "2912",  # 統一超
            "2915",  # 潤泰全
            "2923",  # 鼎固-KY
            "2929",  # 淘帝-KY
        ]
    },
    
    # ========== 營建類股 ==========
    "營建": {
        "name": "營建建材",
        "description": "營建、建材",
        "symbols": [
            "2501",  # 國建
            "2506",  # 太設
            "2511",  # 太子
            "2514",  # 龍邦
            "2515",  # 中工
            "2516",  # 新建
            "2520",  # 冠德
            "2527",  # 宏璟
            "2530",  # 華建
            "2534",  # 宏盛
            "2535",  # 達欣工
            "2536",  # 宏普
            "2537",  # 聯上發
            "2538",  # 基泰
            "2539",  # 櫻花建
            "2540",  # 愛山林
        ]
    },
    
    # ========== 其他產業 ==========
    "汽車": {
        "name": "汽車工業",
        "description": "汽車、零組件",
        "symbols": [
            "2201",  # 裕隆
            "2207",  # 和泰車
            "2227",  # 裕日車
            "2231",  # 為升
            "2239",  # 英利-KY
        ]
    },
    
    "航運": {
        "name": "航運業",
        "description": "海運、空運",
        "symbols": [
            "2603",  # 長榮
            "2609",  # 陽明
            "2610",  # 華航
            "2615",  # 萬海
            "2634",  # 漢翔
            "5608",  # 四維航
        ]
    },
    
    "生技醫療": {
        "name": "生技醫療",
        "description": "製藥、醫材",
        "symbols": [
            "1762",  # 中化生
            "4119",  # 旭富
            "4120",  # 友華
            "4128",  # 中天
            "4129",  # 聯合
            "4130",  # 健亞
            "4131",  # 晶宇
            "4138",  # 曜亞
            "4142",  # 國光生
            "4157",  # 太景*-KY
            "4161",  # 聿新科
            "4167",  # 展旺
            "6446",  # 藥華藥
        ]
    },
    
    "油電燃氣": {
        "name": "油電燃氣業",
        "description": "能源、公用事業",
        "symbols": [
            "1101",  # 台泥
            "9907",  # 統一實
            "9910",  # 豐泰
            "9917",  # 中保科
            "9921",  # 巨大
            "9933",  # 中鼎
            "9934",  # 成霖
            "9935",  # 慶豐富
            "9937",  # 全國
            "9938",  # 百和
            "9939",  # 宏全
            "9940",  # 信義
            "9941",  # 裕融
            "9942",  # 茂順
            "9943",  # 好樂迪
            "9944",  # 新麗
            "9945",  # 潤泰新
        ]
    },
    
    "電機機械": {
        "name": "電機機械",
        "description": "機械、電機設備",
        "symbols": [
            "1503",  # 士電
            "1504",  # 東元
            "1506",  # 正道
            "1507",  # 永大
            "1512",  # 瑞利
            "1513",  # 中興電
            "1514",  # 亞力
            "1515",  # 力山
            "1516",  # 川飛
            "1517",  # 利奇
            "1519",  # 華城
            "1521",  # 大億
            "1522",  # 堤維西
            "1524",  # 耿鼎
            "1525",  # 江申
            "1526",  # 日馳
            "1527",  # 鑽全
            "1528",  # 恩德
            "1529",  # 樂士
            "1530",  # 亞崴
            "1531",  # 高林股
            "1532",  # 勤美
            "1533",  # 車王電
            "1535",  # 中宇
            "1536",  # 和大
            "1537",  # 廣隆
        ]
    },
}

# ============================================================
# 台股指數成分股
# ============================================================

TAIWAN_INDEX_STOCKS = {
    "台灣50": {
        "name": "台灣50指數成分股",
        "description": "台灣市值前50大上市公司",
        "symbols": [
            "2330", "2317", "2454", "2308", "2303", "2882", "2881", 
            "2891", "2886", "2412", "2382", "2002", "2884", "1301",
            "1303", "2892", "2357", "2912", "2395", "2880", "2885",
            "2887", "3711", "2890", "2207", "2353", "6505", "2379",
            "3008", "2409", "5880", "2408", "2301", "2344", "2327",
            "2345", "2615", "3045", "2603", "1326", "2337", "5871",
            "2474", "4904", "2324", "2356", "3481", "9910", "2823",
            "2049"
        ]
    },
    
    "台灣中型100": {
        "name": "台灣中型100指數成分股",
        "description": "市值排名51-150的上市公司",
        "symbols": [
            "2609", "2610", "2352", "2323", "2347", "2368", "2377",
            "2393", "2449", "2458", "3034", "3037", "3231", "3443",
            "4938", "5269", "6415", "6446", "8046", "9904", "9907",
        ]
    },
    
    "高股息": {
        "name": "高股息ETF選股池",
        "description": "高殖利率股票",
        "symbols": [
            "2002", "2801", "2823", "2834", "2880", "2885", "2887",
            "2890", "2892", "5871", "6505", "9904", "9910", "9917",
        ]
    },
}

# ============================================================
# 輔助函數
# ============================================================

def get_all_tw_stocks():
    """獲取所有台股代碼(不重複)"""
    all_symbols = set()
    
    # 從產業分類收集
    for category_data in TAIWAN_STOCK_CATEGORIES.values():
        all_symbols.update(category_data["symbols"])
    
    # 從指數成分股收集
    for index_data in TAIWAN_INDEX_STOCKS.values():
        all_symbols.update(index_data["symbols"])
    
    return sorted(list(all_symbols))


def get_category_stocks(category_name):
    """獲取特定產業的股票清單"""
    if category_name in TAIWAN_STOCK_CATEGORIES:
        return TAIWAN_STOCK_CATEGORIES[category_name]["symbols"]
    elif category_name in TAIWAN_INDEX_STOCKS:
        return TAIWAN_INDEX_STOCKS[category_name]["symbols"]
    else:
        return []


def get_all_categories():
    """獲取所有分類名稱"""
    categories = {
        "產業分類": list(TAIWAN_STOCK_CATEGORIES.keys()),
        "指數成分股": list(TAIWAN_INDEX_STOCKS.keys())
    }
    return categories


def download_all_listed_stocks_from_twse():
    """
    從台灣證券交易所下載完整上市公司清單
    
    返回:
        股票代碼列表
    """
    try:
        import requests
        import pandas as pd
        
        # 台灣證券交易所上市公司清單API
        url = "https://isin.twse.com.tw/isin/C_public.jsp?strMode=2"
        
        response = requests.get(url)
        response.encoding = 'big5'
        
        # 解析表格
        dfs = pd.read_html(response.text)
        df = dfs[0]
        
        # 篩選股票(排除ETF、認購權證等)
        stocks = []
        for idx, row in df.iterrows():
            try:
                code_name = str(row[0])
                if '\u3000' in code_name:  # 包含全形空白
                    code = code_name.split('\u3000')[0].strip()
                    # 只保留純數字代碼(上市股票)
                    if code.isdigit() and len(code) == 4:
                        stocks.append(code)
            except:
                continue
        
        print(f"✅ 從台灣證券交易所下載: {len(stocks)} 支上市股票")
        return sorted(list(set(stocks)))
        
    except Exception as e:
        print(f"❌ 下載失敗: {str(e)}")
        print("⚠️ 使用內建227支台股清單")
        return get_all_tw_stocks()


def print_category_summary():
    """列印分類摘要"""
    print("="*80)
    print("台股完整分類系統")
    print("="*80)
    
    print("\n【產業分類】")
    print("-"*80)
    for name, data in TAIWAN_STOCK_CATEGORIES.items():
        print(f"{name:12} - {data['description']:25} ({len(data['symbols'])} 支)")
    
    print("\n【指數成分股】")
    print("-"*80)
    for name, data in TAIWAN_INDEX_STOCKS.items():
        print(f"{name:12} - {data['description']:25} ({len(data['symbols'])} 支)")
    
    all_stocks = get_all_tw_stocks()
    print("\n" + "="*80)
    print(f"總計: {len(all_stocks)} 支不重複台股")
    print("="*80)


if __name__ == "__main__":
    print_category_summary()
    
    print("\n\n範例: 獲取半導體類股")
    print("-"*80)
    semicon = get_category_stocks("半導體")
    print(f"半導體類股: {semicon[:10]}... (共 {len(semicon)} 支)")
    
    print("\n\n範例: 獲取台灣50成分股")
    print("-"*80)
    tw50 = get_category_stocks("台灣50")
    print(f"台灣50: {tw50[:10]}... (共 {len(tw50)} 支)")
    
    print("\n\n範例: 獲取所有台股")
    print("-"*80)
    all_tw = get_all_tw_stocks()
    print(f"所有台股: {all_tw[:20]}... (共 {len(all_tw)} 支)")
