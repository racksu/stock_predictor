# Taiwan Stock Prediction System v5.0 - Detailed Analysis Documentation

## Overview

The Taiwan Stock Prediction System v5.0 introduces a comprehensive **Five-Dimensional Analysis Framework** that provides detailed reasoning and explanations for every score generated by the system. This document explains the architecture, methodology, and usage of the enhanced detailed analysis features.

---

## Table of Contents

1. [Five-Dimensional Analysis Architecture](#five-dimensional-analysis-architecture)
2. [Weight Allocation](#weight-allocation)
3. [Detailed Analysis Components](#detailed-analysis-components)
4. [Using the Detailed Report Feature](#using-the-detailed-report-feature)
5. [Example Report Output](#example-report-output)
6. [Configuration Guide](#configuration-guide)
7. [Integration with Live Data](#integration-with-live-data)
8. [API Reference](#api-reference)
9. [Best Practices](#best-practices)
10. [Troubleshooting](#troubleshooting)

---

## Five-Dimensional Analysis Architecture

The system analyzes stocks across five critical dimensions, each providing unique insights:

### 1. **Technical Analysis (30% Weight)**

Evaluates price action and momentum indicators:
- **KD Indicator (Stochastic Oscillator)**: Measures momentum and identifies overbought/oversold conditions
- **OBV (On-Balance Volume)**: Confirms price trends with volume analysis
- **Moving Averages (MA5, MA10, MA20, MA60)**: Identifies trend direction and support/resistance
- **RSI (Relative Strength Index)**: Measures strength of price movements
- **MACD (Moving Average Convergence Divergence)**: Analyzes momentum and trend changes

### 2. **Market Analysis (20% Weight)**

Tracks institutional investor activity:
- **Foreign Institutional Investors**: Net buying/selling by international institutions
- **Investment Trusts**: Domestic fund activity
- **Dealer Proprietary Trading**: Securities dealer positioning
- **Combined Institutional Flow**: Overall smart money direction

### 3. **Chips Analysis (20% Weight)**

Analyzes ownership structure and margin trading:
- **Margin Purchase (融資)**: Leveraged long positions and changes
- **Short Selling (融券)**: Short interest and covering activity
- **Margin Ratio**: Leverage level and associated risks
- **Chips Concentration**: Ownership distribution among strong vs. weak hands

### 4. **Macro Analysis (15% Weight)**

Evaluates macro-economic environment:
- **VIX (Volatility Index)**: Global market fear gauge
- **US Dollar Index**: Currency strength impact on emerging markets
- **US Treasury Yield**: Interest rate environment and bond competition
- **Global Risk Sentiment**: Overall market conditions

### 5. **Sentiment Analysis (15% Weight)**

Monitors news and social sentiment:
- **News Sentiment Score**: AI-powered analysis of news articles
- **Sentiment Trend**: Improving, stable, or deteriorating coverage
- **Key Themes**: Dominant narratives in media coverage
- **Sentiment Consistency**: Agreement across news sources

---

## Weight Allocation

The overall stock score is calculated using the following weighted formula:

```
Overall Score = (Technical × 0.30) + (Market × 0.20) + (Chips × 0.20) +
                (Macro × 0.15) + (Sentiment × 0.15)
```

### Rationale for Weight Distribution

1. **Technical Analysis (30%)**
   - Most comprehensive dimension with 5 sub-indicators
   - Direct reflection of price action and momentum
   - Critical for entry/exit timing

2. **Market Analysis (20%)**
   - "Smart money" often predicts market moves
   - Institutional flows provide strong signals
   - High reliability but can lag price action

3. **Chips Analysis (20%)**
   - Unique to Taiwan market structure
   - High margin leverage increases volatility
   - Critical for understanding retail sentiment

4. **Macro Analysis (15%)**
   - Broader market context
   - Affects all stocks systematically
   - Important but less stock-specific

5. **Sentiment Analysis (15%)**
   - Forward-looking indicator
   - Can identify emerging narratives
   - Less quantitative, more qualitative

### Customizing Weights

You can adjust weights in `detailed_analysis_reporter.py`:

```python
self.weights = {
    'technical': 0.30,    # Adjust these values
    'market': 0.20,
    'chips': 0.20,
    'macro': 0.15,
    'sentiment': 0.15
}
```

**Note**: Weights must sum to 1.0 (100%)

---

## Detailed Analysis Components

### Technical Analysis Breakdown

#### KD Indicator Analysis

**Scoring Logic:**
- K > 80: Overbought → Score -20 (bearish)
- K < 20: Oversold → Score +20 (bullish)
- K > D (Golden Cross): Score +15 (bullish momentum)
- K < D (Death Cross): Score -15 (bearish momentum)
- Divergence > 20: Strong directional momentum

**Example Reasoning:**
```
"K value at 75.50 is in neutral range (20-80), indicating balanced momentum."
"K line (75.50) is above D line (68.20), showing bullish momentum."
"Large divergence between K and D (7.30) suggests strong directional momentum."
```

#### OBV (On-Balance Volume) Analysis

**Scoring Logic:**
- Rising OBV + Rising Price: Score +35 (strong bullish confirmation)
- Falling OBV + Falling Price: Score -35 (strong bearish confirmation)
- Rising OBV + Falling Price: Score +25 (bullish divergence - accumulation)
- Falling OBV + Rising Price: Score -25 (bearish divergence - distribution)

**Example Reasoning:**
```
"OBV is in an uptrend (change: +8.50%), indicating accumulation by investors."
"OBV rising with price confirms strong buying pressure - bullish confirmation."
"Significant OBV change (8.50%) indicates strong conviction in current direction."
```

#### Moving Average Analysis

**Scoring Logic:**
- Price above all MAs (4/4): Score +25 (strong uptrend)
- Price below all MAs (0/4): Score -25 (strong downtrend)
- Perfect bullish alignment (MA5 > MA10 > MA20 > MA60): Score +20
- Perfect bearish alignment (MA5 < MA10 < MA20 < MA60): Score -20

**Example Reasoning:**
```
"Price (585.00) is above all moving averages - strong uptrend."
"Moving averages are in perfect bullish alignment (MA5 > MA10 > MA20 > MA60)."
"Short-term golden cross pattern (MA5 > MA10 > MA20) suggests bullish momentum."
```

#### RSI Analysis

**Scoring Logic:**
- RSI > 70: Score -20 (overbought, potential reversal)
- RSI > 80: Additional Score -10 (extremely overbought)
- RSI < 30: Score +20 (oversold, rebound potential)
- RSI < 20: Additional Score +10 (extremely oversold)
- RSI 40-60: Neutral zone

**Example Reasoning:**
```
"RSI at 62.50 shows bullish momentum but not yet overbought."
"RSI is trending upward, indicating strengthening momentum."
```

#### MACD Analysis

**Scoring Logic:**
- MACD > Signal: Score +15 (bullish configuration)
- MACD < Signal: Score -15 (bearish configuration)
- Histogram expanding: Score ±10 (strengthening momentum)
- MACD > 0: Score +5 (long-term bullish)
- MACD < 0: Score -5 (long-term bearish)

**Example Reasoning:**
```
"MACD (3.20) is above signal line (2.10) - bullish configuration."
"MACD histogram is positive and expanding - strengthening bullish momentum."
"MACD is above zero line - longer-term bullish trend."
```

### Market Analysis Breakdown

#### Institutional Investor Activity

**Scoring Logic:**
- Foreign net buy > 1M shares: Score +25 (strong buying)
- Foreign net sell < -1M shares: Score -25 (strong selling)
- Trust net buy: Score +10
- Dealer net buy: Score +5

**Example Reasoning:**
```
"Foreign institutional investors net bought 2,500,000 shares, showing international confidence."
"Significant foreign institutional buying: 2,500,000 shares"
"Combined institutional net flow: +3,650,000 shares."
"Positive combined institutional money flow indicates strong buying support"
```

### Chips Analysis Breakdown

#### Margin Trading Analysis

**Scoring Logic:**
- Margin purchase increase > 500K: Score +20 (strong retail bullish sentiment)
- Margin purchase decrease < -500K: Score -20 (weakening sentiment)
- Short selling increase: Score -10 (bearish bets)
- Short selling decrease (covering): Score +10 (potential squeeze)
- High margin ratio > 40%: Score -15 (leverage risk)
- Low margin ratio < 30%: Score +5 (low risk)

**Example Reasoning:**
```
"Margin purchase increased by 1,200,000 shares, showing leveraged buying interest."
"Significant increase in margin purchase indicates strong retail bullish sentiment"
"Short selling decreased by 250,000 shares (short covering), potentially bullish."
"Significant short covering detected - potential short squeeze catalyst"
"Moderate margin ratio (28.5%) suggests balanced leverage usage."
```

### Macro Analysis Breakdown

#### VIX Analysis

**Scoring Logic:**
- VIX < 15: Score +15 (low fear, stable market)
- VIX > 30: Score -20 (high fear, risk-off)
- VIX surge > 10%: Score -10 (rapidly increasing fear)
- VIX drop < -10%: Score +10 (fear subsiding)

**Example Reasoning:**
```
"VIX at 14.50 indicates low market fear and complacent sentiment."
"Low VIX indicates stable market environment"
```

#### US Dollar Index Analysis

**Scoring Logic:**
- Dollar strengthening: Score -10 (pressure on EM assets)
- Dollar weakening: Score +10 (support for EM assets)

**Example Reasoning:**
```
"US Dollar weakening (level: 101.20) typically supports emerging market assets."
"Weakening US Dollar provides tailwinds for Taiwan stocks"
```

#### Treasury Yield Analysis

**Scoring Logic:**
- Yield > 5.0%: Score -15 (tight conditions)
- Yield < 3.0%: Score +10 (accommodative)
- Yield rising > 0.2%: Score -10 (pressure on equities)
- Yield falling < -0.2%: Score +10 (support for equities)

**Example Reasoning:**
```
"10-year Treasury yield at 3.80% indicates accommodative conditions."
"Treasury yield falling sharply (-0.15%) supports equity valuations."
```

### Sentiment Analysis Breakdown

#### News Sentiment Scoring

**Scoring Logic:**
- Sentiment > 0.3: Score +20 (positive coverage)
- Sentiment < -0.3: Score -20 (negative coverage)
- Sentiment improving: Score +10
- Sentiment deteriorating: Score -10
- Low variance: High consensus
- High variance: Mixed opinions

**Example Reasoning:**
```
"Positive news sentiment (score: 0.62) based on 32 recent articles."
"Positive media coverage with sentiment score of 0.62"
"News sentiment is improving over time - positive momentum in public perception."
"High sentiment consistency across news sources indicates clear market consensus."
"Key news themes: Record quarterly earnings, Strong AI chip demand, Expanding market share"
```

---

## Using the Detailed Report Feature

### Basic Usage

```python
from detailed_analysis_reporter import DetailedAnalysisReporter

# Create reporter instance
reporter = DetailedAnalysisReporter()

# Prepare your data
stock_data = {
    'kd': {'k': 75.5, 'd': 68.2},
    'obv': {'current': 15000000, 'trend': 'rising', 'change_pct': 5.2},
    'price': {'current': 585.0, 'trend': 'rising'},
    # ... more data
}

analysis_results = {
    'technical': {'score': 72},
    'market': {'score': 68},
    'chips': {'score': 65},
    'macro': {
        'score': 58,
        'vix': {'level': 18.5, 'change': -2.5},
        'dollar_index': {'level': 103.5, 'trend': 'weakening'},
        'treasury_yield': {'level': 4.2, 'change': -0.1}
    },
    'sentiment': {
        'score': 70,
        'sentiment_score': 0.45,
        'article_count': 25,
        'trend': 'improving',
        # ... more data
    }
}

# Generate comprehensive report
report = reporter.generate_comprehensive_report(
    stock_code='2330',
    stock_data=stock_data,
    analysis_results=analysis_results
)

# Display formatted text report
text_report = reporter.format_report_as_text(report)
print(text_report)

# Save reports to files
reporter.save_report_to_file(report, 'analysis_report_2330.txt')
# This saves both .txt and .json versions
```

### Running the Test Suite

```bash
# Run comprehensive test with all scenarios
python test_enhanced_analysis_with_report.py
```

This will generate:
- Reports for 3 scenarios (Bullish, Bearish, Mixed)
- Both text and JSON formats
- Comparative analysis across scenarios
- Individual indicator demonstrations

### Report Output Structure

The generated report includes:

1. **Executive Summary**
   - Overall score (0-100)
   - Investment recommendation (Strong Buy, Buy, Hold, Sell, Strong Sell)
   - Confidence level (High, Moderate, Low)

2. **Dimension Scores**
   - Individual scores for all 5 dimensions
   - Weight-adjusted contributions

3. **Detailed Analysis**
   - Technical: All 5 indicators with reasoning
   - Market: Institutional activity breakdown
   - Chips: Margin trading analysis
   - Macro: Economic indicators
   - Sentiment: News analysis

4. **Investment Considerations**
   - Strengths (bullish factors)
   - Weaknesses (bearish factors)
   - Risk warnings (important cautions)

---

## Example Report Output

### Sample Executive Summary

```
================================================================================
TAIWAN STOCK PREDICTION SYSTEM - DETAILED ANALYSIS REPORT
================================================================================
Stock Code: 2330
Analysis Date: 2025-11-26 14:30:00
Overall Score: 75.40/100

--------------------------------------------------------------------------------
INVESTMENT RECOMMENDATION: Strong Buy
Confidence Level: High
Reasoning: Multiple dimensions show strong bullish signals with minimal downside risks.
--------------------------------------------------------------------------------

FIVE-DIMENSIONAL ANALYSIS SCORES:
  1. Technical Analysis:    78.00/100 (Weight: 30%)
  2. Market Analysis:       75.00/100 (Weight: 20%)
  3. Chips Analysis:        72.00/100 (Weight: 20%)
  4. Macro Analysis:        68.00/100 (Weight: 15%)
  5. Sentiment Analysis:    80.00/100 (Weight: 15%)
```

### Sample Technical Analysis Section

```
================================================================================
1. TECHNICAL ANALYSIS
================================================================================

KD:
  Signal: BULLISH
  Score: 80.00/100
  Reasoning:
    - K value at 65.50 is in neutral range (20-80), indicating balanced momentum.
    - K line (65.50) is above D line (58.20), showing bullish momentum.
    - Large divergence between K and D (7.30) suggests strong directional momentum.

OBV:
  Signal: BULLISH
  Score: 85.00/100
  Reasoning:
    - OBV is in an uptrend (change: +8.50%), indicating accumulation by investors.
    - OBV rising with price confirms strong buying pressure - bullish confirmation.
    - Significant OBV change (8.50%) indicates strong conviction in current direction.

Summary: Technical indicators show strong bullish consensus (4/5 bullish signals).
The stock demonstrates positive momentum across multiple timeframes.
```

### Sample Investment Considerations

```
================================================================================
INVESTMENT CONSIDERATIONS
================================================================================

STRENGTHS:
  1. KD indicator shows oversold condition - good entry opportunity
  2. OBV and price both rising - strong bullish confirmation
  3. Perfect bullish MA alignment detected
  4. Positive combined institutional money flow indicates strong buying support
  5. Significant short covering detected - potential short squeeze catalyst
  6. Low VIX indicates stable market environment
  7. Positive media coverage with sentiment score of 0.62

WEAKNESSES:
  (none identified in this strong bullish scenario)

RISK WARNINGS:
  1. High margin ratio (42.5%) increases forced selling risk during corrections
```

---

## Configuration Guide

### Setting Up News Sentiment Analysis

The system uses **NewsAPI** for news sentiment analysis. Follow these steps:

#### 1. Get NewsAPI Key

1. Visit [NewsAPI.org](https://newsapi.org/)
2. Sign up for a free account
3. Copy your API key from the dashboard

#### 2. Configure the System

Create a configuration file `config.json`:

```json
{
  "newsapi": {
    "api_key": "your_newsapi_key_here",
    "language": "en",
    "sort_by": "publishedAt",
    "page_size": 50
  },
  "analysis": {
    "lookback_days": 7,
    "min_articles": 5
  },
  "sentiment": {
    "positive_threshold": 0.3,
    "negative_threshold": -0.3
  }
}
```

#### 3. Usage in Code

```python
import json
import requests
from datetime import datetime, timedelta

def fetch_news_sentiment(stock_code, config):
    """Fetch and analyze news sentiment using NewsAPI."""

    api_key = config['newsapi']['api_key']
    lookback_days = config['analysis']['lookback_days']

    # Calculate date range
    end_date = datetime.now()
    start_date = end_date - timedelta(days=lookback_days)

    # Search for news articles
    url = 'https://newsapi.org/v2/everything'
    params = {
        'q': f'Taiwan stock {stock_code}',
        'from': start_date.strftime('%Y-%m-%d'),
        'to': end_date.strftime('%Y-%m-%d'),
        'language': config['newsapi']['language'],
        'sortBy': config['newsapi']['sort_by'],
        'pageSize': config['newsapi']['page_size'],
        'apiKey': api_key
    }

    response = requests.get(url, params=params)
    articles = response.json().get('articles', [])

    # Analyze sentiment (use your preferred NLP library)
    # ... sentiment analysis logic ...

    return {
        'sentiment_score': 0.45,
        'article_count': len(articles),
        'trend': 'improving',
        'key_themes': ['earnings', 'growth', 'innovation']
    }
```

### Setting Up Market Data Integration

#### Taiwan Stock Exchange (TWSE) API

```python
import requests

def fetch_institutional_data(stock_code, date):
    """Fetch institutional investor data from TWSE."""

    url = 'https://www.twse.com.tw/fund/T86'
    params = {
        'response': 'json',
        'date': date.strftime('%Y%m%d'),
        'stockNo': stock_code
    }

    response = requests.get(url, params=params)
    data = response.json()

    # Parse the response
    # ... parsing logic ...

    return {
        'foreign_investors': {'net_buy': 1500000},
        'investment_trust': {'net_buy': 500000},
        'dealer_proprietary': {'net_buy': 200000}
    }
```

#### Margin Trading Data

```python
def fetch_margin_data(stock_code, date):
    """Fetch margin trading data from TWSE."""

    url = 'https://www.twse.com.tw/exchangeReport/MI_MARGN'
    params = {
        'response': 'json',
        'date': date.strftime('%Y%m%d'),
        'stockNo': stock_code
    }

    response = requests.get(url, params=params)
    data = response.json()

    # Parse the response
    # ... parsing logic ...

    return {
        'margin_purchase': {
            'change': 800000,
            'balance': 5000000,
            'ratio': 35.5
        },
        'short_selling': {
            'change': -150000,
            'balance': 500000
        }
    }
```

### Setting Up Macro Data Integration

#### VIX Data

```python
import yfinance as yf

def fetch_vix_data():
    """Fetch VIX data using yfinance."""

    vix = yf.Ticker('^VIX')
    hist = vix.history(period='5d')

    current_vix = hist['Close'].iloc[-1]
    previous_vix = hist['Close'].iloc[-2]
    vix_change = ((current_vix - previous_vix) / previous_vix) * 100

    return {
        'level': current_vix,
        'change': vix_change
    }
```

#### US Dollar Index and Treasury Yield

```python
def fetch_macro_indicators():
    """Fetch macro indicators."""

    # US Dollar Index
    dxy = yf.Ticker('DX-Y.NYB')
    dxy_hist = dxy.history(period='10d')
    dxy_current = dxy_hist['Close'].iloc[-1]
    dxy_trend = 'strengthening' if dxy_hist['Close'].iloc[-1] > dxy_hist['Close'].iloc[-5] else 'weakening'

    # 10-Year Treasury Yield
    tnx = yf.Ticker('^TNX')
    tnx_hist = tnx.history(period='5d')
    yield_current = tnx_hist['Close'].iloc[-1]
    yield_change = tnx_hist['Close'].iloc[-1] - tnx_hist['Close'].iloc[-2]

    return {
        'dollar_index': {
            'level': dxy_current,
            'trend': dxy_trend
        },
        'treasury_yield': {
            'level': yield_current,
            'change': yield_change
        }
    }
```

---

## API Reference

### DetailedAnalysisReporter Class

#### Constructor

```python
reporter = DetailedAnalysisReporter()
```

#### Methods

##### generate_comprehensive_report()

```python
report = reporter.generate_comprehensive_report(
    stock_code: str,
    stock_data: Dict[str, Any],
    analysis_results: Dict[str, Any]
) -> Dict[str, Any]
```

**Parameters:**
- `stock_code`: Stock symbol (e.g., '2330')
- `stock_data`: Historical stock data and indicators
- `analysis_results`: Analysis results from all dimensions

**Returns:**
- Dictionary containing comprehensive report with detailed explanations

##### format_report_as_text()

```python
text_report = reporter.format_report_as_text(report: Dict[str, Any]) -> str
```

**Parameters:**
- `report`: Report dictionary from `generate_comprehensive_report()`

**Returns:**
- Formatted text string ready for display or saving

##### save_report_to_file()

```python
reporter.save_report_to_file(report: Dict[str, Any], filename: str) -> None
```

**Parameters:**
- `report`: Report dictionary
- `filename`: Path to save the report (without extension)

**Saves:**
- `{filename}.txt`: Human-readable text format
- `{filename}.json`: Machine-readable JSON format

### Report Structure

#### Report Dictionary Schema

```python
{
    'stock_code': str,
    'analysis_date': str,
    'overall_score': float,
    'recommendation': {
        'action': str,  # 'Strong Buy', 'Buy', 'Hold', 'Sell', 'Strong Sell'
        'confidence': str,  # 'High', 'Moderate', 'Low'
        'reasoning': str,
        'score': float
    },
    'dimension_scores': {
        'technical': float,
        'market': float,
        'chips': float,
        'macro': float,
        'sentiment': float
    },
    'detailed_analysis': {
        'technical': {
            'score': float,
            'indicators': {
                'kd': {...},
                'obv': {...},
                'moving_averages': {...},
                'rsi': {...},
                'macd': {...}
            },
            'summary': str
        },
        'market': {...},
        'chips': {...},
        'macro': {...},
        'sentiment': {...}
    },
    'strengths': List[str],
    'weaknesses': List[str],
    'risk_warnings': List[str]
}
```

---

## Best Practices

### 1. Regular Data Updates

- Update technical indicators daily after market close
- Fetch institutional data daily (available next day)
- Update macro indicators daily
- Refresh news sentiment every 6-12 hours

### 2. Interpretation Guidelines

#### Overall Score Ranges

- **75-100 (Strong Buy)**: Multiple strong bullish signals, high confidence
- **60-74 (Buy)**: More bullish than bearish signals, moderate confidence
- **45-59 (Hold)**: Mixed signals, wait for clarity
- **30-44 (Sell)**: More bearish than bullish signals
- **0-29 (Strong Sell)**: Multiple strong bearish signals

#### Dimensional Conflicts

When dimensions conflict:
1. **Technical vs. Market**: Weight Technical higher for short-term trades
2. **Chips vs. Technical**: High margin ratio with bullish technicals → Caution
3. **Macro vs. Stock-Specific**: Macro headwinds can overwhelm stock positives
4. **Sentiment vs. Fundamentals**: Verify sentiment with actual data

### 3. Risk Management

Always consider:
- **High margin ratio (>40%)**: Increases volatility risk
- **Bearish divergences**: Price and volume/momentum disconnect
- **Macro headwinds**: Rising VIX, strong dollar, rising yields
- **Negative institutional flow**: Smart money exiting

### 4. Customization

Adjust for your strategy:

```python
# Day traders: Increase technical weight
self.weights = {
    'technical': 0.50,
    'market': 0.15,
    'chips': 0.15,
    'macro': 0.10,
    'sentiment': 0.10
}

# Long-term investors: Increase market and macro weights
self.weights = {
    'technical': 0.20,
    'market': 0.30,
    'chips': 0.10,
    'macro': 0.25,
    'sentiment': 0.15
}
```

### 5. Backtesting

Always backtest with historical data:

```python
from backtesting_engine import BacktestingEngine

# Create backtesting engine
engine = BacktestingEngine(
    start_date='2023-01-01',
    end_date='2024-12-31',
    initial_capital=1000000
)

# Run backtest with your settings
results = engine.run_backtest(
    stock_code='2330',
    strategy='detailed_analysis',
    weights=custom_weights
)

print(f"Total Return: {results['total_return']:.2f}%")
print(f"Sharpe Ratio: {results['sharpe_ratio']:.2f}")
print(f"Max Drawdown: {results['max_drawdown']:.2f}%")
```

---

## Troubleshooting

### Common Issues

#### 1. No News Data Available

**Problem**: `article_count: 0` in sentiment analysis

**Solutions:**
- Check NewsAPI key is valid
- Verify stock is covered in English/Chinese news
- Expand search terms (company name, industry keywords)
- Increase lookback period

#### 2. Missing Institutional Data

**Problem**: Institutional net flows all zero

**Solutions:**
- Check TWSE API is accessible
- Verify date format (YYYYMMDD)
- Note: Data available T+1 (next trading day)
- Check for market holidays

#### 3. Calculation Errors

**Problem**: Indicators returning NaN or None

**Solutions:**
- Ensure sufficient historical data (60+ days for MA60)
- Check for data gaps or missing values
- Verify data types are numeric
- Handle edge cases (division by zero)

#### 4. Inconsistent Scores

**Problem**: Scores don't match expectations

**Solutions:**
- Review individual indicator reasoning
- Check if weights are customized
- Verify input data quality
- Consider multiple timeframes

### Debug Mode

Enable detailed logging:

```python
import logging

logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

# Add to reporter methods for debugging
logger = logging.getLogger(__name__)
logger.debug(f"Analyzing KD: K={k_value}, D={d_value}")
```

### Data Validation

Validate input data before analysis:

```python
def validate_stock_data(stock_data):
    """Validate stock data completeness."""

    required_fields = [
        'kd', 'obv', 'price', 'moving_averages',
        'rsi', 'macd', 'foreign_investors',
        'margin_purchase', 'short_selling'
    ]

    for field in required_fields:
        if field not in stock_data:
            raise ValueError(f"Missing required field: {field}")

    # Validate numeric ranges
    if 'rsi' in stock_data:
        rsi = stock_data['rsi'].get('current', 0)
        if not 0 <= rsi <= 100:
            raise ValueError(f"Invalid RSI value: {rsi}")

    return True
```

---

## Advanced Features

### 1. Multi-Stock Comparison

```python
def compare_stocks(stock_codes):
    """Compare multiple stocks side-by-side."""

    reporter = DetailedAnalysisReporter()
    reports = {}

    for code in stock_codes:
        stock_data = fetch_stock_data(code)
        analysis_results = perform_analysis(stock_data)
        reports[code] = reporter.generate_comprehensive_report(
            code, stock_data, analysis_results
        )

    # Create comparison table
    print(f"{'Stock':<10} {'Score':<10} {'Rec':<15} {'Tech':<10} {'Market':<10}")
    print("-" * 55)

    for code, report in reports.items():
        print(f"{code:<10} "
              f"{report['overall_score']:<10.2f} "
              f"{report['recommendation']['action']:<15} "
              f"{report['dimension_scores']['technical']:<10.2f} "
              f"{report['dimension_scores']['market']:<10.2f}")
```

### 2. Historical Trend Analysis

```python
def analyze_score_trend(stock_code, days=30):
    """Analyze how scores have changed over time."""

    reporter = DetailedAnalysisReporter()
    historical_scores = []

    for i in range(days):
        date = datetime.now() - timedelta(days=i)
        stock_data = fetch_stock_data(stock_code, date)
        analysis_results = perform_analysis(stock_data)
        report = reporter.generate_comprehensive_report(
            stock_code, stock_data, analysis_results
        )

        historical_scores.append({
            'date': date,
            'overall_score': report['overall_score'],
            'recommendation': report['recommendation']['action']
        })

    return historical_scores
```

### 3. Alert System

```python
def setup_alerts(stock_code, thresholds):
    """Set up alerts for significant changes."""

    alerts = []

    # Strong buy signal
    if overall_score >= thresholds['strong_buy']:
        alerts.append({
            'type': 'STRONG_BUY',
            'message': f'{stock_code} score reached {overall_score:.2f}'
        })

    # High VIX warning
    if vix_level > thresholds['vix_warning']:
        alerts.append({
            'type': 'RISK_WARNING',
            'message': f'VIX elevated at {vix_level:.2f}'
        })

    # Margin ratio warning
    if margin_ratio > thresholds['margin_warning']:
        alerts.append({
            'type': 'LEVERAGE_WARNING',
            'message': f'High margin ratio: {margin_ratio:.1f}%'
        })

    return alerts
```

---

## Performance Optimization

### 1. Caching

```python
from functools import lru_cache
from datetime import datetime

@lru_cache(maxsize=100)
def cached_fetch_stock_data(stock_code, date_str):
    """Cache stock data fetches."""
    return fetch_stock_data(stock_code, datetime.strptime(date_str, '%Y-%m-%d'))
```

### 2. Batch Processing

```python
def batch_analyze_stocks(stock_codes, max_workers=5):
    """Analyze multiple stocks in parallel."""

    from concurrent.futures import ThreadPoolExecutor

    reporter = DetailedAnalysisReporter()

    def analyze_single(code):
        stock_data = fetch_stock_data(code)
        analysis_results = perform_analysis(stock_data)
        return reporter.generate_comprehensive_report(
            code, stock_data, analysis_results
        )

    with ThreadPoolExecutor(max_workers=max_workers) as executor:
        reports = list(executor.map(analyze_single, stock_codes))

    return dict(zip(stock_codes, reports))
```

---

## Contributing

To contribute improvements to the detailed analysis system:

1. Fork the repository
2. Create a feature branch
3. Add tests for new indicators or dimensions
4. Update documentation
5. Submit a pull request

---

## License

Taiwan Stock Prediction System v5.0
Copyright (c) 2025

---

## Support

For questions or issues:
- Check the troubleshooting section
- Review example code in `test_enhanced_analysis_with_report.py`
- Open an issue on GitHub
- Contact: support@example.com

---

## Changelog

### v5.0 (2025-11-26)
- Added five-dimensional analysis framework
- Implemented detailed reasoning for all indicators
- Created comprehensive report generation
- Added strengths/weaknesses/risk warnings
- Integrated news sentiment analysis
- Enhanced customization options

### v4.0
- Added backtesting system
- Implemented web interface
- Enhanced technical indicators

### v3.0
- Basic multi-dimensional analysis
- Initial institutional data integration

---

**Last Updated**: 2025-11-26
**Version**: 5.0
**Status**: Production Ready
